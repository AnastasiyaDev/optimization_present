<!DOCTYPE html>
<html lang="en">
<head>
    <title>Пути Оптимизации неисповедимы</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="node_modules/@shower/ribbon/styles/styles.css">
    <style>
        .shower {
            --slide-ratio: calc(16 / 9);
            --ribbon-size: 40px;
        }

        .slide::after {
            background-image: none;
            background-color: #faec6f;
            color: #000;
        }

        .progress {
            --color-blue: #faec6f;
        }
    </style>
</head>
<body class="shower list">

    <header class="caption">
        <h1>Пути Оптимизации неисповедимы</h1>
        <p>Ася Бахнарь</p>
    </header>

    <section class="slide clear" id="cover">
        <h2>Viae Optimization imperceptae sunt</h2>
        <p class="subtitle">
            <span >(Пути Оптимизации неисповедимы)</span>
        </p>

        <p class="note">Brought to you by Asya Bakhnar</p>

        <style>
            #cover h2 {
                margin: 30px 0 0;
                color: black;
                text-align: center;
                font-size: 63px;
            }

            #cover p {
                position: absolute;
                bottom: 0;
                right: 50px;
                text-align: center;
                font-style: italic;
                font-size: 20px;
            }

            #cover .subtitle {
                position: relative;
                text-align: right;
                font-size: 34px;
            }
        </style>
    </section>

    <section class="slide" id="why">
        <h2>Что происходит?</h2>

        <figure>
            <img class="place bottom left" src="pictures/not-sure.jpg" alt="not-sure">
        </figure>

        <style>
            #why .place {
                position: relative;
                max-width: 410px;
            }
        </style>
    </section>

    <section class="slide" id="resurce">
        <figure>
            <img class="place bottom left" src="pictures/book.jpg" alt="not-sure">
        </figure>

        <p class="place right center modenr-tool-title">
            <span class="plus">+</span>
            <img src="pictures/modern-tools-logo.svg" alt="modern-tools-logo"/>
            <span class="h3">Modern DevTools</span>
        </p>

        <style>
            #resurce img {
                max-width: 50%;        
            }

            #resurce .plus {
                vertical-align: middle;
                font-size: 2em;
                font-weight: bold;
                padding: 0 2rem;
                color: #192231;
            }

            #resurce .modenr-tool-title {
                width: 50%;
            }

            #resurce .modenr-tool-title img {
                display: inline-block;
                vertical-align: middle;
                width: 100px;
            }
            
            .h3 {
                font-size: 1.17em;
                font-weight: bold;
            }
        </style>
    </section>

    <section class="slide" id="http">
        <h2>Протоколы передачи данных</h2>
        <table>
            <tr>
                <th scope="col"></th>
                <th>HTTP1.1</th>
                <th>HTTP2</th>
            </tr>
            <tr>
                <th scope="row">head-of-line blocking</th>
                <td>не больше 6ти запросов за раз</td>
                <td>мультиплексирование + приоритезация</td>
            </tr>
            <tr>
                <th scope="row">uncompressed headers</th>
                <td>сервер сжимает только тело запроса, но&nbsp;не&nbsp;заголовки</td>
                <td>HPACK</td>
            </tr>
            <tr>
                <th scope="row">nonsecure websites</th>
                <td>серверы не обязаны использовать&nbsp;SSL</td>
                <td>использует SSL-соединения</td>
            </tr>
            <tr>
                <th scope="row">тип протокола</th>
                <td>текстовый</td>
                <td>бинарный</td>
            </tr>
            <tr>
                <th scope="row"></th>
                <td></td>
                <td>SERVER PUSH (nginx 1.13.9)</td>
            </tr>
            </table>

            <style>
                #http td {
                    font-size: .8em;
                }

                #http th {
                    line-height: 1.4;
                }
            </style>
    </section>

    <section class="slide">
        <h2>Антипаттерны оптимизации для HTTP/2</h2>
        <ul>
            <li class="next">Bundling CSS and JavaScript</li>
            <li class="next">Image sprites</li>
            <li class="next">Asset inlining</li>
        </ul>

        <p class="next"><strong>Ухудшается эффективность кэшировая</strong></p>

        <ul>
            <li class="next">Domain Sharding</li>
        </ul>
    </section>

    <section class="slide" id="http2">
        <h2>Можно ничего не делать</h2>
        
        <figure>
            <img class="place center center" src="pictures/http2.png" alt="http2">
        </figure>

        <style>
            #http2 {
                background-color: #f5f7f9;
            }

            #http2 img {
                max-width: 280px;
            }
        </style>
    </section>

    <section class="slide" id="render">
        <h2>Как браузер рендерит страницу</h2>
        
        <figure>
            <img class="place center center" src="pictures/rendering.png" alt="render">
        </figure>

        <style>
            #render img {
                max-width: 82%;
            }
        </style>
    </section>

    <section class="slide" id="layer">
        <h2>Слой (композитный слой)</h2>

        <p class="note">&mdash; часть страницы, поддерево DOM. Отрисовывается независимо, компонуется в GPU</p>

        <ul>
            <li class="next">Элементы с 3D-трансформацией (translateZ hack - transform: translateZ(0);)</li>
            <li class="next">&lt;video&gt; с включенным h/a (Hardware acceleration)</li>
            <li class="next">&lt;canvas&gt; с 3D или 2D с включенным h/a</li>
            <li class="next">Плагины (flash, silverlight)</li>
            <li class="next">CSS фильтры</li>
            <li class="next">Элементы, вынесенные над композитным слоем (т.е. z-index)</li>
            <li class="next">will-change</li>
        </ul>

        <style>
            #layer pre {
                display: inline-block;
            }

            #layer .note {
                font-size: 22px;
                line-height: 1;
            }
        </style>
    </section>

    <section class="slide">
        <h2>Метрики загрузки страницы</h2>
        <figure>
            <img class="place center center" src="pictures/metric.png" alt="metric">
        </figure>
    </section>

    <section class="slide">
        <h2>Прогрессивные веб-метрики (ПВМ)</h2>
        <figure>
            <img class="place center bottom" src="pictures/performance-metrics.png" alt="performance-metrics">
        </figure>
    </section>

    <section class="slide">
        <h2>Инструменты</h2>

        <ul>
            <li class="next"><a href="https://developers.google.com/speed/pagespeed/insights/">Google PageSpeed Insight</a></li>
            <li class="next"><a href="https://tools.pingdom.com/">pingdom</a></li>
            <li class="next">Lighthouse (таба Audits)</li>
            <li class="next"><a href="https://www.thinkwithgoogle.com/feature/testmysite">Speed Scorecard</a></li>
            <li class="next">Google Chrome’s devTools</li>
        </ul>
    </section>

    <section class="slide" id="fps">
        <h2>Performance</h2>

        <ul>
            <li>FPS<br><a class="next" href="http://jakearchibald.github.io/jank-invaders/"><small>Jank-эффект</small></a></li>
        </ul>

        <figure>
            <img class="place right bottom next" src="pictures/60-fps.jpg" alt="60-fps">
        </figure>

        <ul>
            <li class="next">Network</li>
            <li class="next">CPU</li>
            <li class="next">Frame</li>
            <li class="next">Main</li>
            <li class="next">Raster</li>
        </ul>

        <style>
            #fps {
                background-color: #000;
            }

            #fps li {
                color: white;
            }
        </style>
    </section>

    <section class="slide clear" id="ploho">
        <figure>
            <img class="cover" src="pictures/ploho.png" alt="">
        </figure>
    </section>

    <section class="slide">
        <h2>User Timing</h2>

        <code>window.performance.mark('my_mark');</code>
        <code>window.performance.measure('u text', 'domComplete', 'my_mark');</code>

        <br>Посмотреть события - <a href="https://developer.mozilla.org/ru/docs/Web/API/Navigation_timing_API">PerformanceTiming</a>

        <div class="next">
            <span>Посмотреть все метки и замеры:</span><br>
            <code>performance.getEntriesByType('mark');</code>
            <code>performance.getEntriesByType('measure');</code>  
        </div>
    </section>

    <section class="slide clear">
        <h2 class="shout shrink">Фронтовая оптимизация</h2>
    </section>

    <section class="slide" id="opt_res">
        <h2>Оптимизация ресурсов</h2>
        <h4>Минимизация</h4>

        <code>
            npm i -g minifier html-minify
        </code>

        <mark class="important">minifier deprecated</mark>

        <ul>
            <li><span>HTML</span>, <code>htmlminify -o index.html index.src.html</code></li>
            <li><span>CSS</span>, <code>minify -o ./css/styles.min.css ./css/styles.css</code></li>
            <li><span>JS</span>, <code>minify -o jquery.min.js jquery.js</code></li>
            <li><span>Images</span></li>
        </ul>

        <style>
            #opt_res li span {
                background-color: black;
                color: white;
            }
        </style>
    </section>

    <section class="slide" id="opt_img">
        <h2>Оптимизация картинок</h2>

        <ul>
            <li><a href="https://imageoptim.com">ImageOptim</a></li>
            <li><a href="https://tinypng.com/">tinypng</a></li>
            <li><a href="https://squoosh.app">squoosh</a></li>
        </ul>

        <figure>
            <img class="place center bottom next" src="pictures/shakal_c.jpg" alt="shakal">
        </figure>


        <style>
            #opt_img img {
                max-width: 50%;
            }
        </style>
    </section>

    <section class="slide" id="resp_img">
        <h2>Отзывчивые картинки</h2>

        <ul>
            <li>Не респонсивный вариант<br>
                <pre><code>&lt;img src="img/xsmall.jpg" class="articleImageFull"
     srcset="img/small.jpg 512w, img/medium.jpg 768w, img/large.jpg 1280w"
     sizes="(min-width:  704px) 50vw,  (min-width:  480px) 75vw, 100vw"&gt;</code>
                </pre>
            </li>
            <li><code>picture</code> + picturefill (для IE)<br>
                <pre class="small"><code>&lt;picture&gt;
  &lt;source srcset="banner_m.jpg, banner_m@2x.jpg 2x" media="(max-width: 768px)"&gt;
  &lt;source srcset="banner_t.jpg, banner_t@2x.jpg 2x" media="screen and (min-width: 768px) and (max-width: 1024px)"&gt;
  &lt;source srcset="banner.jpg, banner@2x.jpg 2x" media="screen and (min-width: 1025px)"&gt;
  &lt;img srcset="banner.jpg" alt=""&gt;
&lt;/picture></code>
                </pre>
            </li>
        </ul>

        <style>
            #resp_img pre {
                font-size: .7em;
            }

            #resp_img pre.small {
                font-size: .6em;
            }
        </style>
    </section>

    <section class="slide" id="svg">
        <h2>SVG</h2>

        <ul>
            <li class="next"><code>npm i -g svgo</code></li>
            <li class="next"><a href="https://imageoptim.com">ImageOptim</a></li>
            <li class="next"><a href="https://jakearchibald.github.io/svgomg/">svgomg</a></li>
            <li class="next">ручками</li>
        </ul>

        <h3 class="next">Не важно как, главное убрать лишнее!</h3>
    </section>

    <section class="slide" id="webP">
        <img class="" src="pictures/webp-support.png" alt="webp support">

        <div style="text-align: right">
            <a href="https://pastebin.com/">Конвектор</a>
        </div>

        <pre><code>&lt;picture&gt;
    &lt;source srcset="img/amp-small.webp" type="image/webp"&gt;
    &lt;img src="img/amp-small.jpg"&gt;
&lt;/picture&gt;
        </code>
        </pre>

        <style>
            #webP img {
                display: block;
                max-width: 100%;
                margin: 0 auto;
            }

            #webP pre {
                font-size: .8em;
            }
        </style>
    </section>

    <section class="slide" id="webPChart">
        <h2>WebP в сравнении с JPEG и PNG</h2>

        <figure>
            <img class="place center left" src="pictures/webp-chart-1.png" alt="">
        </figure>

        <figure>
            <img class="place center right" src="pictures/webp-chart-2.png" alt="">
        </figure>

        <style>
            #webPChart img {
                max-width: 50%;
            }
        </style>
    </section>

    <section class="slide" id="fonts">
        <h2>Шрифты</h2>
        <table>
            <tr>
                <th scope="col"></th>
                <th>Extension</th>
                <th>Browser support</th>
            </tr>
            <tr>
                <th scope="row">TrueType</th>
                <td>ttf</td>
                <td>Все, кроме IE8-</td>
            </tr>
            <tr>
                <th scope="row">OpenType</th>
                <td>eot</td>
                <td>IE6+</td>
            </tr>
            <tr>
                <th scope="row">WOFF</th>
                <td>woff</td>
                <td>Все, кроме Android Browser 4.3- и IE8-</td>
            </tr>
            <tr>
                <th scope="row">WOFF2</th>
                <td>woff2</td>
                <td>Все современные, кроме IE</td>
            </tr>
        </table>
        <p>Для конвертации: <code>npm i -g ttf2eot ttf2woff ttf2woff2</code></p>
    </section>

    <section class="slide" id="fontsCascade">
        <h2>@font-face cascade</h2>

        <pre>
            <code>@font-face {</code>
            <code>    font-family: "Open Sans Light";</code>
            <code>    font-weight: 300;</code>
            <code>    font-style: normal;</code>
            <code>    src: local("Open Sans Extra Light"),</code>
            <code>         local("OpenSans-Light"),</code>
            <code>         url("open-sans/OpenSans-Light.woff2") format("woff2"),</code>
            <code>         url("open-sans/OpenSans-Light.woff") format("woff"),</code>
            <code>         url("open-sans/OpenSans-Light.eot") format("embedded-opentype"),</code>
            <code>         url("open-sans/OpenSans-Light.ttf") format("truetype");</code>
            <code>}</code>
        </pre>

        <style>
            #fontsCascade pre {
                font-size: .7em;
            }
        </style>
    </section>

    <section class="slide">
        <h2>Загрузка шрифтов</h2>

        <ul>
            <li>FOIT (Flash of Invisible Text) — «мелькание невидимого текста»</li>
            <li>FOUT (Flash of Unstyled Text) — «мелькание неоформленного текста»</li>
        </ul>

        <p>
            Internet Explorer и Edge используют FOUT и отображают запасные шрифты, пока веб-шрифт не закончит свою
            загрузку. Все остальные браузеры используют FOIT и прячут текст во время загрузки веб-шрифтов.
        </p>
    </section>

    <section class="slide" id="fontDisplay">
        <h3><code>font-display</code></h3>

        <ul>
            <li><code>auto</code> — обычно это поведение <code>block</code></li>
            <li><code>block</code> — короткий период блокировки (3 секунды) и&nbsp;бесконечный период замены</li>
            <li><code>swap</code> — короткий период блокировки (3 секунды) и&nbsp;бесконечный период замены</li>
            <li><code>fallback</code> — очень короткий период блокировки (100 мс или меньше) и&nbsp;короткий период замены (3 секунды)</li>
            <li><code>optional</code> —  очень короткий период блокировки (100 мс или меньше) и&nbsp;период замены в 0 секунды.</li>
        </ul>

        <style>
            #fontDisplay ul {
                line-height: 1.6;
            }
        </style>
    </section>

    <section class="slide" id="js">
        <h2>Выполнение JS</h2>

        <img class="" src="pictures/js-default.png" alt="js-default">

        <div>
            <strong>async</strong>
            <img class="" src="pictures/js-async.png" alt="js-async">
        </div>

        <div>
            <strong>defer</strong>
            <img class="" src="pictures/js-defer.png" alt="js-defer">
        </div>


        <style>
            #js h2 {
                margin-bottom: 0;
            }

            #js img {
                max-width: 100%;
                padding-bottom: 10px;
            }

            #js div {
                position: relative;
            }

            #js strong {
                position: absolute;
            }
        </style>
    </section>

    <section class="slide">
        <h2>CSS</h2>

        <ul>
            <li>DRY (don’t repeat yourself).</li>
            <li>Писать сокращенными правилами (padding, margin, font).</li>
            <li>Не усложнять селекторы, чем вложенность меньше, тем лучше ( <= 3 ).</li>
            <li>Грузить только те стили, которые нужны на конкретной странице.</li>
            <li>Стараться не использовать @import в CSS (именно в CSS). </li>
            <li><code>&lt;link&gt;</code> должны быть в <code>&lt;head&gt;</code>.</li>
            <li>CSS transition быстрее, чем Query animate().</li>
        </ul>
    </section>

    <section class="slide" id="cssSelectors">
        <h2>The performance of the CSS selector</h2>

        <img class="" src="pictures/css-selectors.png" alt="css-selectors">

        <style>
            #cssSelectors h2 {
                margin-bottom: 0;
            }
            #cssSelectors img {
                max-width: 64%;
            }
        </style>
    </section>

    <section class="slide" id="cssRender">
        <h2>Этапы рендеринга CSS-свойств</h2>

        <figure>
            <img class="pipeline" src="pictures/pipelineForFrames.png" alt="pipeline css render">
        </figure>

        <p class="next">
            BRO: <code>transform</code>, <code>opacity</code> и <code>filter</code> - пропускают этапы <strong>Layout</strong> и <strong>Paint</strong>, обработаны напрямую через GPU.
        </p>

        <p class="next">
            <a class="csstriggers-link" href="https://csstriggers.com/">csstriggers</a>
        </p>

        <img class="place center bottom next" src="pictures/csstriggers.png" alt="csstriggers">

        <style>
            #cssRender img.pipeline {
                max-width: 100%;
                padding-bottom: 20px;
            }

            #cssRender img.place {
                max-width: 60%;
            }

            #cssRender p {
                font-size: .9em;
            }

            #cssRender .csstriggers-link {
                transform: translateY(82px) rotate(-90deg);
                display: inline-block;
            }
        </style>
    </section>

    <section class="slide" id="resourceHints">
        <h2>Ресурсные подсказки (Resource Hints)</h2>

        <ul>
            <li><strong>Dns-prefetch</strong> &mdash; устанавливает DNS, TCP, TLS связь</li>
            <li><strong>Preconnect</strong> &mdash; браузер преобразует имя домена в IP адрес в фоне</li>
            <li><strong>Prefetch</strong> &mdash; браузер загрузит его с низким приоритетом и положит в кэш (можно запросить активы с другой страницы)</li>
            <li><strong>Subresource</strong> &mdash; то же самое что и <strong>Prefetch</strong>, только с высоким приоритетом</li>
            <li><strong>Preload</strong> &mdash; то же самое что и <strong>Prefetch</strong>, но браузер всегда загрузит ресурс</li>
            <li><strong>Prerender</strong> &mdash; заранее загружает ресурс/страницу и всё содержимое в фоне</li>
        </ul>

        <code>&lt;link rel="preload" href="https://olololo.ru/jquery.min.js" as="script"&gt;</code>

        <style>
            #resourceHints li {
                line-height: 1.55;
            }
        </style>
    </section>

    <section class="slide clear">
        <h2 class="shout shrink">Серверная оптимизация</h2>
    </section>

    <section class="slide">
        <h2>Нужны админы. Или нет?</h2>

        <ul>
            <li><a href="https://www.modpagespeed.com/doc/">Google mod_pagespeed</a></li>
            <li><a href="https://www.cloudflare.com/">Cloudflare</a> - по дефолту подключен на лореали</li>
        </ul>

        <p>
            <a href="https://support.cloudflare.com/hc/en-us/articles/200169486-Is-CloudFlare-compatible-with-mod-pagespeed">Пишут</a> что у
            <strong>Google mod_pagespeed</strong> и <strong>Cloudflare</strong> нет конфликтов
        </p>

        <h2 class="next">Админы нужны.</h2>
    </section>

    <section class="slide">
        <h2>CDN</h2>
        <figure>
            <blockquote>
                <p>Стоит отказаться от доменного шардинга. Такой способ распределения множества файлов по различным доменам и CDN актуален для HTTP 1.1, так как решает проблему параллельных соединений. Но в случае с новым протоколом такое решение ухудшает производительность и нивелирует приоритизацию трафика..</p>
            </blockquote>
            <figcaption><a href="https://ruhighload.com/%D0%9E%D0%BF%D1%82%D0%B8%D0%BC%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F+%D0%B2+http%2F2">Оптимизация в HTTP/2</a></figcaption>
        </figure>

        <h3>
            для мобилки &mdash; <code>7-17</code>,&nbsp;&nbsp;для десктопа &mdash; <code>4-6</code>
        </h3>
    </section>

    <section class="slide clear">
        <h2 class="shout shrink">Best practices</h2>
    </section>

    <section class="slide" id="best">
        <ul>
            <li class="next">Использовать <code>rel="noopener"</code> для ссылок на внешние ресурсы с <code>target="_blank"</code></li>
            <li class="next">В JS <code>read-write-write-write</code></li>
            <li class="next"><code>-webkit-line-clamp: 3;</code><br>
                <img class="truncate" src="/pictures/truncate.png" alt="truncate">
            </li>
        </ul>

        <style>
            #best .truncate {
                max-width: 80%;
            }
        </style>
    </section>

    <section class="slide" id="best2">
        <ul>
            <li class="next"><strong>lazyload</strong> на картинках и на блоках не попадающих во вьюпорт (карусели с продуктами)</li>
            <li class="next">Сборка Cerave на М2</li>
            <li class="next">еще что-то, слишком поздно уже, не могу вспомнить...</li>
        </ul>
    </section>

    <section class="slide">
        <h2>Использовать <code>&lt;picture&gt;</code></h2>

        <ul>
            <li>Для баннеров на главной</li>
            <li>Не только на главной</li>
            <li>(Не только для баннеров)</li>
        </ul>

        <p>
            <a href="https://kerastase.ru/blond-absolu-landing">Пример</a>
        </p>

        <p>
            Что надо бы сделать: или запилить таску с <a href="https://www.npmjs.com/package/gulp-responsive">gulp-responsive</a> или скрипт с
            <a href="http://www.imagemagick.org/script/download.php">ImageMagick</a>
        </p>
    </section>

    <section class="slide clear" id="see-more">
        <h2 class="shout">
            <a href="https://github.com/AnastasiyaDev/optimization-notes/">See more on GitHub</a>
        </h2>
        <style>
            #see-more h2 {
                font-size: 100px;
            }

            #see-more a {
                background-image: linear-gradient( to top, rgb(0, 0, 0) .06em, transparent .06em );
                color: black;
            }
        </style>
    </section>

    <div class="progress"></div>

    <script src="node_modules/shower-core/shower.min.js"></script>
</body>
</html>
